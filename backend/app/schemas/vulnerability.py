"""
Vulnerability schemas
"""
from pydantic import BaseModel
from typing import Optional, List, Dict, Any
from datetime import datetime


class ScanInfo(BaseModel):
    id: int
    filename: str
    original_filename: str
    
    class Config:
        from_attributes = True


class RemediationCommand(BaseModel):
    title: str
    command: str
    os: str
    description: Optional[str] = None
    requires_sudo: bool = False
    is_destructive: bool = False


class VulnerabilityBase(BaseModel):
    service_name: str
    service_version: Optional[str] = None
    port: Optional[int] = None
    protocol: Optional[str] = None
    description: Optional[str] = None
    severity: Optional[str] = None


class VulnerabilityResponse(VulnerabilityBase):
    id: int
    scan_id: int
    cve_id: Optional[str] = None
    cvss_score: Optional[float] = None
    recommendation: Optional[str] = None
    remediation_commands: Optional[List[RemediationCommand]] = None
    status: str
    created_at: datetime
    updated_at: Optional[datetime] = None
    scan: Optional[ScanInfo] = None
    
    class Config:
        from_attributes = True


class VulnerabilityUpdate(BaseModel):
    status: Optional[str] = None
    notes: Optional[str] = None


class FeedbackCreate(BaseModel):
    rating: int
    comment: Optional[str] = None
    feedback_type: Optional[str] = "general"